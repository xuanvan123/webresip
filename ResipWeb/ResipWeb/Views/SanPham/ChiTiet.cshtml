@model ResipWeb.Models.SanPham
<style>
    /* Ép khung ảnh chính: chiều cao cố định, ảnh không bị méo */
    .main-img {
        height: 450px; /* Bạn có thể chỉnh 400px hoặc 500px tùy ý */
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f8f8f8; /* Nền xám nhẹ nếu ảnh không đủ khít khung */
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #eee;
    }

    #mainPhoto {
        max-height: 100%;
        max-width: 100%;
        width: auto;
        height: auto;
        object-fit: contain; /* Giữ nguyên tỷ lệ ảnh, không bị cắt */
    }

    /* Ép các ảnh nhỏ (thumbnails) thành hình vuông đều nhau */
    .thumb-img {
        width: 100%;
        height: 80px; /* Chiều cao cố định cho ảnh nhỏ */
        object-fit: cover; /* Ép ảnh lấp đầy khung hình vuông */
        margin-bottom: 10px;
        transition: 0.3s;
    }

        .thumb-img:hover {
            border: 2px solid #026625; /* Thêm viền khi di chuột vào */
            opacity: 0.8;
        }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

<div class="container" style="margin-top: 80px !important; margin-bottom: 50px;">
    <div class="row">
        <div class="col-md-6">
            <div class="main-img mb-3">
                <img src="@Url.Content(Model.AnhChinh)" class="img-fluid w-100" id="mainPhoto" />
            </div>
            <div class="row">
                @if (Model.SanPhamAnhs != null)
                {
                    @foreach (var anh in Model.SanPhamAnhs.OrderBy(x => x.ThuTu))
                    {
                        <div class="col-3">
                            <img src="@Url.Content(anh.Url)" class="img-thumbnail thumb-img"
                                 style="cursor:pointer" onclick="changeImg('@Url.Content(anh.Url)')" />
                        </div>
                    }
                }
            </div>
        </div>

        <div class="col-md-6">
            <h1>@Model.TenSanPham</h1>
            <p class="text-muted">Mã sản phẩm: @Model.SKU</p>
            <h3 class="text-danger">@Model.GiaBan.ToString("N0") VNĐ</h3>
            @if (Model.GiaCu.HasValue)
            {
                <p><del>@Model.GiaCu.Value.ToString("N0") VNĐ</del></p>
            }

            <div class="my-4">
                <h5>Mô tả ngắn:</h5>
                <div class="short-description">
                    @Html.Raw(Model.MoTaNgan)
                </div>
            </div>

            <form id="addToCartForm" asp-controller="Cart" asp-action="AddToCart" method="post">
                <input type="hidden" name="SanPhamId" value="@Model.Id" />
                <div class="mb-3 w-25">
                    <label>Số lượng:</label>
                    <input type="number" name="SoLuong" id="txtSoLuong" value="1" min="1" class="form-control" />
                </div>
                <button type="button" onclick="themVaoGioHang()" class="btn btn-primary btn-lg">THÊM VÀO GIỎ HÀNG</button>
            </form>
        </div>
    </div>

    <div class="row mt-5">
        <div class="col-12">
            <h4>Mô tả chi tiết</h4>
            <hr />
            <div class="detail-content">
                @Html.Raw(Model.MoTaChiTiet)
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    function changeImg(url) {
        document.getElementById('mainPhoto').src = url;
    }

    function themVaoGioHang() {
        const form = document.getElementById('addToCartForm');
        const formData = new FormData(form);

        fetch(form.action, {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (response.ok) {
                // HIỆN THÔNG BÁO THÀNH CÔNG
                Swal.fire({
                    title: 'Đã thêm vào giỏ!',
                    text: 'Sản phẩm đã sẵn sàng trong giỏ hàng.',
                    icon: 'success',
                    timer: 7000,
                    showConfirmButton: false,
                    background: '#f0f9f4',
                    color: '#026625',
                    timerProgressBar: true
                }).then(() => {
                    window.location.reload();
                });
            } else {
                Swal.fire({
                    title: 'Thông báo',
                    text: 'Vui lòng đăng nhập để thêm sản phẩm vào giỏ hàng.',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Đăng nhập ngay',
                    cancelButtonText: 'Để sau'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = '/Account/Login';
                    }
                });
            }
        })
        .catch(error => console.error('Lỗi:', error));
    }
</script>